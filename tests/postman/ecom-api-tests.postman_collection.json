{
  "info": {
    "name": "Ecom API Tests",
    "description": "Comprehensive API smoke/regression requests for user, product, inventory, order, and payment services.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. User Service",
      "item": [
        {
          "name": "TC-AUTH-001 Register success",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/auth/register",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{test_user_email}}\",\n  \"password\": \"{{test_user_password}}\",\n  \"firstName\": \"Test\",\n  \"lastName\": \"User\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () { pm.response.to.have.status(200); });",
                  "const data = pm.response.json();",
                  "pm.test('has accessToken', function () { pm.expect(data.accessToken).to.be.a('string').and.not.empty; });",
                  "pm.environment.set('access_token', data.accessToken);",
                  "pm.environment.set('customer_access_token', data.accessToken);"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-AUTH-004 Login success",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{test_user_email}}\",\n  \"password\": \"{{test_user_password}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () { pm.response.to.have.status(200); });",
                  "const data = pm.response.json();",
                  "pm.environment.set('access_token', data.accessToken);",
                  "pm.environment.set('customer_access_token', data.accessToken);"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-AUTH-005 Login invalid password",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/auth/login",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{test_user_email}}\",\n  \"password\": \"wrong-password\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 401', function () { pm.response.to.have.status(401); });"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-AUTH-007 Refresh success with cookie",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/refresh-token"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200 or 401 depending on cookie support', function () {",
                  "  pm.expect([200, 401]).to.include(pm.response.code);",
                  "});",
                  "if (pm.response.code === 200) {",
                  "  const data = pm.response.json();",
                  "  pm.environment.set('access_token', data.accessToken);",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-AUTH-010 Logout success",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/auth/logout"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 204', function () { pm.response.to.have.status(204); });"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-USER-001 Get current user",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{base_url}}/users/me"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () { pm.response.to.have.status(200); });",
                  "const data = pm.response.json();",
                  "if (data.id) { pm.environment.set('user_id', String(data.id)); }"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "2. Product Service",
      "item": [
        {
          "name": "TC-CAT-001 Create category",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{admin_access_token}}" }
            ],
            "url": "{{base_url}}/categories",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Electronics-{{timestamp}}\",\n  \"description\": \"Device category\",\n  \"parentId\": null\n}"
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.environment.set('timestamp', Date.now());"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () { pm.response.to.have.status(200); });",
                  "const data = pm.response.json();",
                  "if (data.id) { pm.environment.set('category_id', String(data.id)); }"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-CAT-003 Get categories",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/categories"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () { pm.response.to.have.status(200); });"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-PROD-001 Create product",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{admin_access_token}}" }
            ],
            "url": "{{base_url}}/products",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Phone-{{timestamp}}\",\n  \"description\": \"Smartphone\",\n  \"price\": 499.99,\n  \"categoryId\": {{category_id}},\n  \"sellerId\": 10,\n  \"status\": \"ACTIVE\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () { pm.response.to.have.status(200); });",
                  "const data = pm.response.json();",
                  "if (data.id) { pm.environment.set('product_id', String(data.id)); }"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-PROD-004 Get all products",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/products"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () { pm.response.to.have.status(200); });"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-PROD-006 Get product by id",
          "request": {
            "method": "GET",
            "url": "{{base_url}}/products/{{product_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () { pm.response.to.have.status(200); });"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-PROD-008 Update product",
          "request": {
            "method": "PUT",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{admin_access_token}}" }
            ],
            "url": "{{base_url}}/products/{{product_id}}",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Phone-{{timestamp}}-Updated\",\n  \"description\": \"Updated description\",\n  \"price\": 549.99,\n  \"categoryId\": {{category_id}},\n  \"sellerId\": 10,\n  \"status\": \"ACTIVE\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () { pm.response.to.have.status(200); });"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "3. Inventory Service",
      "item": [
        {
          "name": "TC-INV-001 Add stock",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/inventory/add",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productId\": {{product_id}},\n  \"quantity\": 50\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200', function () { pm.response.to.have.status(200); });"]
              }
            }
          ]
        },
        {
          "name": "TC-INV-003 Set stock",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/inventory/set",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"productId\": {{product_id}},\n  \"quantity\": 40\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200', function () { pm.response.to.have.status(200); });"]
              }
            }
          ]
        },
        {
          "name": "TC-INV-005 Reserve stock",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/inventory/reserve",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orderId\": {{order_id}},\n  \"productId\": {{product_id}},\n  \"quantity\": 2\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200 or 409', function () { pm.expect([200, 409]).to.include(pm.response.code); });"]
              }
            }
          ]
        },
        {
          "name": "TC-INV-008 Confirm reservation",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/inventory/confirm/{{order_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200', function () { pm.response.to.have.status(200); });"]
              }
            }
          ]
        },
        {
          "name": "TC-INV-010 Release reservation",
          "request": {
            "method": "POST",
            "url": "{{base_url}}/inventory/release/{{order_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200', function () { pm.response.to.have.status(200); });"]
              }
            }
          ]
        },
        {
          "name": "TC-INV-012 Batch stock",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/inventory/batch",
            "body": {
              "mode": "raw",
              "raw": "[{{product_id}}]"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200', function () { pm.response.to.have.status(200); });"]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "4. Order Service",
      "item": [
        {
          "name": "TC-ORD-001 Create order",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/orders",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"items\": [\n    {\n      \"productId\": {{product_id}},\n      \"quantity\": 1,\n      \"price\": 549.99\n    }\n  ]\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200 or 409', function () { pm.expect([200, 409]).to.include(pm.response.code); });",
                  "if (pm.response.code === 200) {",
                  "  const data = pm.response.json();",
                  "  if (data.id) { pm.environment.set('order_id', String(data.id)); }",
                  "}"
                ]
              }
            }
          ]
        },
        {
          "name": "TC-ORD-002 Get order by id (owner)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{base_url}}/orders/{{order_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200/403/404', function () { pm.expect([200, 403, 404]).to.include(pm.response.code); });"]
              }
            }
          ]
        },
        {
          "name": "TC-ORD-003 Get all orders (admin)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{admin_access_token}}" }
            ],
            "url": "{{base_url}}/orders"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200 or 403', function () { pm.expect([200, 403]).to.include(pm.response.code); });"]
              }
            }
          ]
        },
        {
          "name": "TC-ORD-004 Get my orders",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{base_url}}/orders/my-orders"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200 or 401', function () { pm.expect([200, 401]).to.include(pm.response.code); });"]
              }
            }
          ]
        },
        {
          "name": "TC-ORD-005 Get user orders (admin)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{admin_access_token}}" }
            ],
            "url": "{{base_url}}/orders/user/{{user_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200 or 403', function () { pm.expect([200, 403]).to.include(pm.response.code); });"]
              }
            }
          ]
        },
        {
          "name": "TC-ORD-006 Cancel order",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{access_token}}" }
            ],
            "url": "{{base_url}}/orders/{{order_id}}/cancel"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200/403/404', function () { pm.expect([200, 403, 404]).to.include(pm.response.code); });"]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "5. Payment Service",
      "item": [
        {
          "name": "TC-PAY-001 Initiate payment",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": "{{base_url}}/payments/initiate",
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orderId\": {{order_id}},\n  \"amount\": 549.99,\n  \"paymentMethod\": \"CARD\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 200 or 404', function () { pm.expect([200, 404]).to.include(pm.response.code); });"]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "6. Cleanup",
      "item": [
        {
          "name": "TC-PROD-011 Delete product",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{admin_access_token}}" }
            ],
            "url": "{{base_url}}/products/{{product_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 204 or 404', function () { pm.expect([204, 404]).to.include(pm.response.code); });"]
              }
            }
          ]
        },
        {
          "name": "TC-CAT-006 Delete category",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{admin_access_token}}" }
            ],
            "url": "{{base_url}}/categories/{{category_id}}"
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": ["pm.test('status is 204 or 404', function () { pm.expect([204, 404]).to.include(pm.response.code); });"]
              }
            }
          ]
        }
      ]
    }
  ]
}
